webpackJsonp([25],{"3nZm":function(e,a,t){"use strict";function r(e){t("Q8ni")}Object.defineProperty(a,"__esModule",{value:!0});var s=t("oAV5"),l=(t("NC6I"),t("r4Fr")),n=t("ydQb"),c={data:function(){return{oneKeyType:"",captchaShow:!1,token:sessionStorage.getItem("token")?sessionStorage.getItem("token"):localStorage.getItem("token"),userCard:[],userCardCache:[],cardPage:Number(this.$route.query.page)||1,cardTotle:0,myMarket:[],serverTime:0,pageChangeing:!1,wantList:{},searchForm:{star:this.$route.query.star||"0",havewant:this.$route.query.havewant||"0",cry:this.$route.query.cry||"0",rightType:this.$route.query.rightType||"0",leftType:this.$route.query.leftType||"0",sort:this.$route.query.sort||"0"},sellCardTotle:0,sellCardPage:Number(this.$route.query.sellPage)||1,seledCardPackage:this.$route.query.packageId||"0",cardPackage:[]}},components:{captcha:n.a},mounted:function(){this.$emit("l2dMassage","这里可以寄售多余的卡牌来换取星星。"),this.getUserMarket(this.sellCardPage),this.getWant(),this.getCardPackage()},methods:{changepackageId:function(){this.searchForm={star:"0",havewant:"0",cry:"0",rightType:"0",leftType:"0",sort:"0"},this.cardPage=1,this.getWant()},getCardPackage:function(){var e=this;l.a.searchcardpackage().then(function(a){0==a.data.code?e.$message.error(a.data.msg):1==a.data.code&&(e.cardPackage=a.data.data)})},sellCardPageChange:function(e){this.getUserMarket(e),Object(s.i)(180,200)},searchChanged:function(){this.cardPage=1,this.cardPageChange(1)},getWant:function(){var e=this,a={token:this.token,packageId:this.seledCardPackage};l.a.searchwantcard(a).then(function(a){if(0==a.data.code)e.$message.error(a.data.msg);else if(1==a.data.code){for(var t={},r=0;r<a.data.data.length;r++)t[a.data.data[r]._id]=a.data.data[r].count;e.wantList=t,e.getUserCard()}})},updataMany:function(e){this.oneKeyType=e,this.captchaShow=!0},sendCaptcha:function(e){var a=this,t={type:this.oneKeyType,token:this.token,captcha:e};l.a.marketsell(t).then(function(e){a.$refs.captch.captchaUpdata(),0==e.data.code?a.$message.error(e.data.msg):1==e.data.code&&(a.captchaShow=!1,a.$message({message:e.data.msg,type:"success"}),a.sellCardPage=1,a.getUserMarket(a.sellCardPage),a.$emit("updateUserinfo"))})},captchaDigShow:function(e){this.captchaShow=e},editCard:function(e,a,t,r,s){var l=1;t&&(l=2),this.$router.push({name:"cardDetail",query:{type:"sell",card:e.cardId,stat:l,price:r,time:a,id:s,packageId:e.packageId,star:e.star,title:encodeURIComponent(e.title),name:encodeURIComponent(e.name)}})},getUserMarket:function(e){var a=this,t={type:"search",token:this.token,page:e};l.a.marketsell(t).then(function(e){if(0==e.data.code)a.$message.error(e.data.msg);else if(1==e.data.code){if(e.data.data.length<=0&&a.sellCardPage>1)return a.sellCardPage=1,a.getUserMarket(1),a.$router.replace({name:"sellCard",query:{page:a.cardPage,star:a.searchForm.star,havewant:a.searchForm.havewant,sellPage:a.sellCardPage}}),!1;a.myMarket=[],setTimeout(function(){a.myMarket=e.data.data},200),a.serverTime=e.data.time,a.sellCardTotle=e.data.totle,a.$router.replace({name:"sellCard",query:{page:a.cardPage,star:a.searchForm.star,havewant:a.searchForm.havewant,sellPage:a.sellCardPage}})}})},upCard:function(e){this.$router.push({name:"cardDetail",query:{type:"sell",card:e.cardId,stat:0,packageId:e.packageId,star:e.star,title:encodeURIComponent(e.title),name:encodeURIComponent(e.name)}})},PrefixInteger_:function(e,a){return Object(s.a)(e,a)},cardPageChange:function(e){function a(e){var a=o.searchForm.star;return"0"===a||e.star==a}function t(e){var a=o.searchForm.cry;return"0"===a||e==a}function r(e){var a=o.searchForm.rightType;return"0"===a||e==a}function s(e){var a=o.searchForm.leftType;return"0"===a||e==a}function l(e,a){var t=o.searchForm.sort;if("0"===t){var r=o.wantList[e.cardId]||0,s=o.wantList[a.cardId]||0;return r||s?r===s?a.star-e.star:s-r:e.star<a.star?1:e.star>a.star?-1:a.cardId-e.cardId}return"1"===t?e.star<a.star?1:e.star>a.star?-1:a.cardId-e.cardId:"2"===t?e.star-a.star:void 0}function n(e){return"0"===o.searchForm.havewant||o.wantList[e]>0}var c=this,o=this,i=this.userCardCache.filter(function(e){return a(e)&&t(e.cry)&&r(e.rightType)&&s(e.leftType)&&n(e.cardId)});i=i.sort(l);var d=i.slice(20*(e-1),20*e);this.cardTotle=i.length,d.length>0&&(this.pageChangeing=!0),this.userCard=[],setTimeout(function(){c.pageChangeing=!1,c.userCard=d},300),this.$router.replace({name:"sellCard",query:{page:this.cardPage,star:this.searchForm.star,cry:this.searchForm.cry,rightType:this.searchForm.rightType,leftType:this.searchForm.leftType,sort:this.searchForm.sort,havewant:this.searchForm.havewant,sellPage:this.sellCardPage,packageId:this.seledCardPackage}})},checkCanBuy:function(e){return e.count>1},getUserCard:function(){var e=this;l.a.searchcardbytoken({token:this.token,packageId:this.seledCardPackage}).then(function(a){if(0==a.data.code)e.$message.error(a.data.msg);else if(1==a.data.code){var t=a.data;if(a.data.card){e.userCardCache=a.data.card||[];for(var r=a.data.cardCount,s=0;s<e.userCardCache.length;s++)e.userCardCache[s].count=r[e.userCardCache[s].cardId]||0;e.userCardCache=e.userCardCache.filter(e.checkCanBuy),e.cardTotle=e.userCardCache.length,e.cardPageChange(e.cardPage)}else e.$message({message:t.nickName+"还没有获得过卡牌呢！",type:"warning"})}})}}},o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"wm_market_content_body"},[t("transition",{attrs:{name:"el-fade-in-linear"}},[e.myMarket.length>0?t("div",{staticClass:"wm_market_selling_body"},[t("h5",{staticClass:"common_title type_shop"},[e._v("贩卖中的卡牌")]),e._v(" "),t("div",{staticClass:"wm_mycard_list"},e._l(e.myMarket,function(a,r){return t("div",{key:r+1,staticClass:"wm_market_mycard_item type_mobile",on:{click:function(t){return e.editCard(a,a.time,a.selled,a.price,a._id)}}},[t("img",{staticClass:"wm_getcard_img",attrs:{src:e.$wikimoecard.url+a.packageId+"/"+a.cardId+".jpg"}}),e._v(" "),t("div",{staticClass:"wm_card_nums"},[t("span",{staticClass:"wm_top_info_star"},[e._v("★")]),e._v(e._s(a.price))]),e._v(" "),a.selled||e.serverTime-a.time>2592e3?t("div",{staticClass:"wm_market_selling_tag"},[a.selled?t("el-tag",{staticClass:"wm_market_selling_tag_item",attrs:{type:"success"},on:{click:function(t){return t.stopPropagation(),e.editCard(a,a.time,a.selled,a.price,a._id)}}},[e._v("可收取星星")]):e._e(),e._v(" "),e.serverTime-a.time>2592e3&&!a.selled?t("el-tag",{staticClass:"wm_market_selling_tag_item",attrs:{type:"danger"},on:{click:function(t){return t.stopPropagation(),e.editCard(a,a.time,a.selled,a.price,a._id)}}},[e._v("过期请更新")]):e._e()],1):e._e()])}),0),e._v(" "),t("div",{staticClass:"wm_market_content_page"},[t("el-pagination",{staticClass:"my_card_page",attrs:{small:"",layout:"prev, pager, next",total:e.sellCardTotle,"current-page":e.sellCardPage,"page-size":20},on:{"current-change":e.sellCardPageChange,"update:currentPage":function(a){e.sellCardPage=a},"update:current-page":function(a){e.sellCardPage=a}}})],1),e._v(" "),t("div",{staticClass:"wm_market_btn_body"},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.updataMany("getstarMany")}}},[e._v("一键领取")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.updataMany("updateMany")}}},[e._v("一键更新")])],1)]):e._e()]),e._v(" "),t("div",[t("h5",{staticClass:"common_title type_shop"},[e._v("可卖的卡牌")]),e._v(" "),t("div",{staticClass:"tc"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"选择卡包"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",attrs:{placeholder:"选择卡包"},on:{change:e.changepackageId},model:{value:e.seledCardPackage,callback:function(a){e.seledCardPackage=a},expression:"seledCardPackage"}},e._l(e.cardPackage,function(e){return t("el-option",{key:e.packageId,attrs:{label:e.name,value:e.packageId}})}),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"选择星级"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",on:{change:e.searchChanged},model:{value:e.searchForm.star,callback:function(a){e.$set(e.searchForm,"star",a)},expression:"searchForm.star"}},[t("el-option",{attrs:{label:"全部",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"1星",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"2星",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"3星",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"4星",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"5星",value:"5"}}),e._v(" "),t("el-option",{attrs:{label:"6星",value:"6"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"水晶属性"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",attrs:{placeholder:"筛选水晶属性"},on:{change:e.searchChanged},model:{value:e.searchForm.cry,callback:function(a){e.$set(e.searchForm,"cry",a)},expression:"searchForm.cry"}},[t("el-option",{attrs:{label:"全部",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"红火",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"蓝水",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"绿风",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"光",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"暗",value:"5"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"被动属性"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",attrs:{placeholder:"筛选被动属性"},on:{change:e.searchChanged},model:{value:e.searchForm.leftType,callback:function(a){e.$set(e.searchForm,"leftType",a)},expression:"searchForm.leftType"}},[t("el-option",{attrs:{label:"全部",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"全能",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"兵攻",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"盾防",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"速度",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"爱心",value:"5"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"主动技能"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",attrs:{placeholder:"筛选主动技能"},on:{change:e.searchChanged},model:{value:e.searchForm.rightType,callback:function(a){e.$set(e.searchForm,"rightType",a)},expression:"searchForm.rightType"}},[t("el-option",{attrs:{label:"全部",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"物",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"魔",value:"2"}}),e._v(" "),t("el-option",{attrs:{label:"防",value:"3"}}),e._v(" "),t("el-option",{attrs:{label:"治",value:"4"}}),e._v(" "),t("el-option",{attrs:{label:"妨",value:"5"}}),e._v(" "),t("el-option",{attrs:{label:"支",value:"6"}}),e._v(" "),t("el-option",{attrs:{label:"特",value:"7"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"是否求购"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",on:{change:e.searchChanged},model:{value:e.searchForm.havewant,callback:function(a){e.$set(e.searchForm,"havewant",a)},expression:"searchForm.havewant"}},[t("el-option",{attrs:{label:"全部",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"有求购",value:"1"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"设置排序"}},[t("el-select",{staticClass:"wm_cardlist_select type_120",attrs:{placeholder:"设置排序"},on:{change:e.searchChanged},model:{value:e.searchForm.sort,callback:function(a){e.$set(e.searchForm,"sort",a)},expression:"searchForm.sort"}},[t("el-option",{attrs:{label:"求购优先",value:"0"}}),e._v(" "),t("el-option",{attrs:{label:"星级高到低",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"星级低到高",value:"2"}})],1)],1)],1)],1),e._v(" "),t("transition",{attrs:{name:"el-fade-in-linear"}},[e.userCard.length<=0&&!e.pageChangeing?t("div",{staticClass:"wm_market_tips"},[e._v("该条件下暂时没有可以卖的卡牌！")]):e._e()]),e._v(" "),t("el-collapse-transition",[e.userCard.length>0?t("div",{staticClass:"wm_mycard_list"},e._l(e.userCard,function(a,r){return t("div",{key:r+1,staticClass:"wm_getcard_box type_mobile wm_market_cansell_card",on:{click:function(t){return e.upCard(a)}}},[t("img",{staticClass:"wm_getcard_img",attrs:{src:e.$wikimoecard.url+a.packageId+"/"+a.cardId+".jpg"}}),e._v(" "),t("div",{staticClass:"wm_card_nums"},[e._v("可卖"+e._s(a.count-1)+"张")]),e._v(" "),e.wantList[a.cardId]?t("div",{staticClass:"wm_card_want_nums"},[e._v(e._s(e.wantList[a.cardId])+"人想要")]):e._e()])}),0):e._e()]),e._v(" "),t("div",{staticClass:"wm_market_content_page"},[t("el-pagination",{staticClass:"my_card_page",attrs:{small:"",layout:"prev, pager, next",total:e.cardTotle,"current-page":e.cardPage,"page-size":20},on:{"current-change":e.cardPageChange,"update:currentPage":function(a){e.cardPage=a},"update:current-page":function(a){e.cardPage=a}}})],1)],1),e._v(" "),e.captchaShow?t("captcha",{ref:"captch",attrs:{codeDigShow:e.captchaShow},on:{captchaShow:e.captchaDigShow,send:e.sendCaptcha}}):e._e()],1)},i=[],d={render:o,staticRenderFns:i},h=d,u=t("VU/8"),p=r,g=u(c,h,!1,p,"data-v-21c0827f",null);a.default=g.exports},Q8ni:function(e,a,t){var r=t("auZa");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t("rjj0")("3f0744e5",r,!0,{})},auZa:function(e,a,t){a=e.exports=t("FZ+f")(!1),a.push([e.i,"\n.wm_market_cansell_card[data-v-21c0827f]{\r\n    position: relative;\r\n    z-index: 1;\n}\n.wm_card_want_nums[data-v-21c0827f]{\r\n    position: absolute;\r\n    z-index: 1;\r\n    right: 10px;\r\n    bottom: 46px;\r\n    background-color: rgba(255,255,255,0.85);\r\n    padding: 2px 5px;\r\n    border-radius: 3px;\r\n    font-size: 12px;\r\n    color: #ff5364;\n}\r\n",""])}});