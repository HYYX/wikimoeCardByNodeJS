webpackJsonp([4],{"3nZm":function(t,a,e){"use strict";function r(t){e("Ixuc")}function s(t){e("ygkz")}Object.defineProperty(a,"__esModule",{value:!0});var n=e("W3Iv"),c=e.n(n),i=e("oAV5"),o=e("NC6I"),l=e.n(o),d=e("r4Fr"),h={props:{codeDigShow:{type:Boolean,default:!1}},data:function(){return{codeShow:this.codeDigShow,captcha:"",captchaSrc:"/api/captcha?time="+(new Date).getTime()}},watch:{codeShow:function(t){this.$emit("captchaShow",t)},codeDigShow:function(t){this.codeShow=t}},methods:{captchaUpdata:function(){this.captchaSrc="/api/captcha?time="+(new Date).getTime()},goto:function(){this.$emit("send",this.captcha)}}},u=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-dialog",{staticClass:"reg_code_dialog",attrs:{title:"请输入验证码",visible:t.codeShow,width:"100%"},on:{"update:visible":function(a){t.codeShow=a}}},[e("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.captcha,callback:function(a){t.captcha=a},expression:"captcha"}},[e("template",{slot:"append"},[e("img",{staticClass:"reg_code_img",attrs:{src:t.captchaSrc},on:{click:t.captchaUpdata}})])],2),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.codeShow=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.goto}},[t._v("确定")])],1)],1)},m=[],_={render:u,staticRenderFns:m},p=_,g=e("VU/8"),v=r,f=g(h,p,!1,v,"data-v-5e615691",null),C=f.exports,w=e("zFli"),y=e.n(w),k={data:function(){return{cardData_:y.a.cardData,oneKeyType:"",captchaShow:!1,token:sessionStorage.getItem("token")?sessionStorage.getItem("token"):localStorage.getItem("token"),userCard:[],userCardCache:[],cardPage:Number(this.$route.query.page)||1,cardTotle:0,myMarket:[],serverTime:0,pageChangeing:!1,wantList:{},searchForm:{star:this.$route.query.star||"0",havewant:this.$route.query.havewant||"0"}}},components:{captcha:C},mounted:function(){this.getUserCard(),this.getUserMarket(),this.getWant()},methods:{searchChanged:function(){this.cardPage=1,this.cardPageChange(1)},getWant:function(){var t=this,a={token:this.token};d.a.searchwantcard(a).then(function(a){if(console.log(a),0==a.data.code)t.$message.error(a.data.msg);else if(1==a.data.code){for(var e={},r=0;r<a.data.data.length;r++)e[a.data.data[r]._id]=a.data.data[r].count;t.wantList=e}})},updataMany:function(t){this.oneKeyType=t,this.captchaShow=!0},sendCaptcha:function(t){var a=this;console.log(t);var e={type:this.oneKeyType,token:this.token,captcha:t};d.a.marketsell(e).then(function(t){console.log(t),a.$refs.captch.captchaUpdata(),0==t.data.code?a.$message.error(t.data.msg):1==t.data.code&&(a.captchaShow=!1,a.$message({message:t.data.msg,type:"success"}),a.getUserMarket(),a.$emit("updateUserinfo"))})},captchaDigShow:function(t){this.captchaShow=t},editCard:function(t,a,e,r,s){var n=1;e&&(n=2),this.$router.push({name:"cardDetail",query:{type:"sell",card:t,stat:n,price:r,time:a,id:s}})},getUserMarket:function(){var t=this,a={type:"search",token:this.token};d.a.marketsell(a).then(function(a){console.log(a),0==a.data.code?t.$message.error(a.data.msg):1==a.data.code&&(t.myMarket=a.data.data,t.serverTime=a.data.time)})},upCard:function(t){this.$router.push({name:"cardDetail",query:{type:"sell",card:t,stat:0}})},PrefixInteger_:function(t,a){return Object(i.a)(t,a)},cardPageChange:function(t){function a(t){var a=s.searchForm.star;return"0"===a||s.cardData_[Object(i.a)(t,4)].star==a}function e(t){return"0"===s.searchForm.havewant||s.wantList[t]>0}var r=this,s=this,n=this.userCardCache.filter(function(t){return a(t[0])&&e(t[0])}),c=n.slice(20*(t-1),20*t);this.cardTotle=n.length,c.length>0&&(this.pageChangeing=!0),this.userCard=[],setTimeout(function(){r.pageChangeing=!1,r.userCard=c},300),this.$router.replace({name:"sellCard",query:{page:this.cardPage,star:this.searchForm.star,havewant:this.searchForm.havewant}})},checkCanBuy:function(t){return t[1]>1},getUserCard:function(){var t=this,a=this.token.split(".")[1],e=JSON.parse(atob(a)).email,r=l()(e);if(!Object(i.e)(r))return this.$message.error("用户信息有误！"),!1;d.a.searchcard({md5:r}).then(function(a){if(console.log(a),0==a.data.code)t.$message.error(a.data.msg);else if(1==a.data.code){var e=a.data;a.data.card?(t.userCardCache=c()(a.data.card),t.userCardCache.reverse(),t.userCardCache=t.userCardCache.filter(t.checkCanBuy),t.cardTotle=t.userCardCache.length,t.cardPageChange(t.cardPage)):t.$message({message:e.nickName+"还没有获得过卡牌呢！",type:"warning"})}})}}},b=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"wm_market_content_body"},[e("transition",{attrs:{name:"el-fade-in-linear"}},[t.myMarket.length>0?e("div",{staticClass:"wm_market_selling_body"},[e("h5",{staticClass:"common_title type_shop"},[t._v("贩卖中的卡牌("+t._s(t.myMarket.length)+"/20)")]),t._v(" "),e("div",{staticClass:"wm_mycard_list"},t._l(t.myMarket,function(a,r){return e("div",{key:r+1,staticClass:"wm_market_mycard_item type_mobile",on:{click:function(e){return t.editCard(a.cardId,a.time,a.selled,a.price,a._id)}}},[e("img",{staticClass:"wm_getcard_img",attrs:{src:"/static/img/"+t.PrefixInteger_(a.cardId,4)+".jpg"}}),t._v(" "),e("div",{staticClass:"wm_card_nums"},[e("span",{staticClass:"wm_top_info_star"},[t._v("★")]),t._v(t._s(a.price))]),t._v(" "),a.selled||t.serverTime-a.time>2592e3?e("div",{staticClass:"wm_market_selling_tag"},[a.selled?e("el-tag",{staticClass:"wm_market_selling_tag_item",attrs:{type:"success"},on:{click:function(e){return t.editCard(a.cardId,a.time,a.selled,a.price,a._id)}}},[t._v("可收取星星")]):t._e(),t._v(" "),t.serverTime-a.time>2592e3&&!a.selled?e("el-tag",{staticClass:"wm_market_selling_tag_item",attrs:{type:"danger"},on:{click:function(e){return t.editCard(a.cardId,a.time,a.selled,a.price,a._id)}}},[t._v("过期请更新")]):t._e()],1):t._e()])}),0),t._v(" "),e("div",{staticClass:"wm_market_btn_body"},[e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.updataMany("getstarMany")}}},[t._v("一键领取")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.updataMany("updateMany")}}},[t._v("一键更新")])],1)]):t._e()]),t._v(" "),e("div",[e("h5",{staticClass:"common_title type_shop"},[t._v("可卖的卡牌")]),t._v(" "),e("div",{staticClass:"tc"},[e("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"星级"}},[e("el-select",{staticClass:"wm_market_buy_search_select",on:{change:t.searchChanged},model:{value:t.searchForm.star,callback:function(a){t.$set(t.searchForm,"star",a)},expression:"searchForm.star"}},[e("el-option",{attrs:{label:"全部",value:"0"}}),t._v(" "),e("el-option",{attrs:{label:"1星",value:"1"}}),t._v(" "),e("el-option",{attrs:{label:"2星",value:"2"}}),t._v(" "),e("el-option",{attrs:{label:"3星",value:"3"}}),t._v(" "),e("el-option",{attrs:{label:"4星",value:"4"}}),t._v(" "),e("el-option",{attrs:{label:"5星",value:"5"}}),t._v(" "),e("el-option",{attrs:{label:"6星",value:"6"}})],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"求购"}},[e("el-select",{staticClass:"wm_market_buy_search_select",on:{change:t.searchChanged},model:{value:t.searchForm.havewant,callback:function(a){t.$set(t.searchForm,"havewant",a)},expression:"searchForm.havewant"}},[e("el-option",{attrs:{label:"全部",value:"0"}}),t._v(" "),e("el-option",{attrs:{label:"有求购",value:"1"}})],1)],1)],1)],1),t._v(" "),e("transition",{attrs:{name:"el-fade-in-linear"}},[t.userCard.length<=0&&!t.pageChangeing?e("div",{staticClass:"wm_market_tips"},[t._v("该条件下暂时没有可以卖的卡牌！")]):t._e()]),t._v(" "),e("el-collapse-transition",[t.userCard.length>0?e("div",{staticClass:"wm_mycard_list"},t._l(t.userCard,function(a,r){return e("div",{key:r+1,staticClass:"wm_getcard_box type_mobile wm_market_cansell_card",on:{click:function(e){return t.upCard(a[0])}}},[e("img",{staticClass:"wm_getcard_img",attrs:{src:"/static/img/"+t.PrefixInteger_(a[0],4)+".jpg"}}),t._v(" "),e("div",{staticClass:"wm_card_nums"},[t._v("可卖"+t._s(a[1]-1)+"张")]),t._v(" "),t.wantList[a[0]]?e("div",{staticClass:"wm_card_want_nums"},[t._v(t._s(t.wantList[a[0]])+"人想要")]):t._e()])}),0):t._e()]),t._v(" "),e("div",{staticClass:"wm_market_content_page"},[e("el-pagination",{staticClass:"my_card_page",attrs:{small:"",layout:"prev, pager, next",total:t.cardTotle,"current-page":t.cardPage,"page-size":20},on:{"current-change":t.cardPageChange,"update:currentPage":function(a){t.cardPage=a},"update:current-page":function(a){t.cardPage=a}}})],1)],1),t._v(" "),t.captchaShow?e("captcha",{ref:"captch",attrs:{codeDigShow:t.captchaShow},on:{captchaShow:t.captchaDigShow,send:t.sendCaptcha}}):t._e()],1)},S=[],x={render:b,staticRenderFns:S},$=x,F=e("VU/8"),P=s,I=F(k,$,!1,P,"data-v-4cba8fa3",null);a.default=I.exports},HSSU:function(t,a,e){a=t.exports=e("FZ+f")(!1),a.push([t.i,"",""])},Ixuc:function(t,a,e){var r=e("HSSU");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);e("rjj0")("2420ba29",r,!0,{})},eX6v:function(t,a,e){a=t.exports=e("FZ+f")(!1),a.push([t.i,"\n.wm_market_cansell_card[data-v-4cba8fa3]{\r\n    position: relative;\r\n    z-index: 1;\n}\n.wm_card_want_nums[data-v-4cba8fa3]{\r\n    position: absolute;\r\n    z-index: 1;\r\n    right: 10px;\r\n    bottom: 46px;\r\n    background-color: rgba(255,255,255,0.85);\r\n    padding: 2px 5px;\r\n    border-radius: 3px;\r\n    font-size: 12px;\r\n    color: #ff5364;\n}\r\n",""])},ygkz:function(t,a,e){var r=e("eX6v");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);e("rjj0")("46b0f7fe",r,!0,{})}});